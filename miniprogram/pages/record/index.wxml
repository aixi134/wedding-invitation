<view class="container">
  <!-- éç®¡ç†å‘˜æç¤º -->
  <view wx:if="{{!isManager}}" class="no-permission">
    <view class="permission-tip">æ‚¨æš‚æ— æƒé™æŸ¥çœ‹è®¿å®¢è®°å½•</view>
    <view class="permission-desc">è¯·è”ç³»ç³»ç»Ÿç®¡ç†å‘˜</view>
  </view>

  <!-- ç®¡ç†å‘˜ç•Œé¢ -->
  <view wx:else class="manager-view">
    <!-- æœç´¢æ  -->
    <view class="search-bar">
      <view class="search-input">
        <input 
          value="{{keyword}}" 
          placeholder="è¾“å…¥è®¿å®¢å§“åæˆ–è®¿é—®ç›®çš„" 
          bindinput="onSearchInput"
          bindconfirm="onSearch"
        />
        <text class="search-icon" bindtap="onSearch">ğŸ”</text>
        <text wx:if="{{keyword}}" class="clear-icon" bindtap="onClearSearch">Ã—</text>
      </view>
    </view>

    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <view class="stats">
      <text>æ¬¢è¿ï¼Œ{{userInfo.name}}</text>
      <text>å…±{{visitorList.length}}æ¡è®°å½•</text>
    </view>

    <!-- è®¿å®¢åˆ—è¡¨ -->
    <scroll-view 
      class="record-list" 
      scroll-y 
      bindscrolltolower="onReachBottom"
    >
      <view wx:if="{{visitorList.length === 0 && !loading}}" class="empty">
        <image src="../../images/icon/play.png" class="empty-image"></image>
        <text class="empty-text">{{keyword ? 'æš‚æ— æœç´¢ç»“æœ' : 'æš‚æ— è®¿å®¢è®°å½•'}}</text>
      </view>

      <view wx:for="{{visitorList}}" wx:key="_id" class="record-item">
        <view class="item-header">
          <text class="visitor-name">{{item.sceneInfo}}</text>
          <text class="visit-time">{{formatTime(item.visitTime)}}</text>
        </view>
        <view class="item-content">
          <text class="purpose">ç›®çš„ï¼š{{item.purpose}}</text>
          <text class="contact">è”ç³»æ–¹å¼ï¼š{{item.contact}}</text>
          <text wx:if="{{item.remark}}" class="remark">å¤‡æ³¨ï¼š{{item.remark}}</text>
        </view>
        <view class="item-footer">
          <text class="create-time">è®°å½•æ—¶é—´ï¼š{{formatTime(item.createTime)}}</text>
          <text class="delete-btn" bindtap="deleteRecord" data-id="{{item._id}}">åˆ é™¤</text>
        </view>
      </view>

      <!-- åŠ è½½çŠ¶æ€ -->
      <view wx:if="{{loading}}" class="loading">åŠ è½½ä¸­...</view>
      <view wx:if="{{!hasMore && visitorList.length > 0}}" class="no-more">æ²¡æœ‰æ›´å¤šæ•°æ®äº†</view>
    </scroll-view>
  </view>
</view>